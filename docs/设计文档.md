# Keymira

## 目录

1. [项目概述](#1-项目概述)
2. [系统架构](#2-系统架构)
3. [功能详细设计](#3-功能详细设计)
4. [数据结构设计](#4-数据结构设计)
5. [界面设计](#5-界面设计)
6. [实现细节](#6-实现细节)
7. [性能考虑](#7-性能考虑)
8. [安全性考虑](#8-安全性考虑)
9. [后续优化计划](#9-后续优化计划)
10. [项目时间线](#10-项目时间线)

## 1. 项目概述

### 1.1 项目目的

开发一款名为Keymira的Windows平台键盘监听与分析软件，实现类似Keycastr的功能，并提供额外的数据分析功能如热力图生成等。本软件旨在帮助用户了解自己的键盘使用习惯，提高打字效率，并为开发者和内容创作者提供有价值的输入数据分析。

### 1.2 主要功能

- 实时显示键盘按键，支持自定义显示设置
- 统计按键使用频率和模式
- 生成键盘使用热力图，支持自定义颜色方案
- 多用户支持，包括数据导入导出功能
- 提供详细的使用统计报告和分析
- 支持开机自启动和隐私保护模式

## 2. 系统架构

### 2.1 开发环境

- 编程语言: Python 3.8+
- GUI框架: PyQt5
- 主要依赖库: 
  - pynput (键盘监听)
  - matplotlib (热力图生成)
  - PyQt5 (图形界面)

### 2.2 模块划分

1. 用户界面模块（UI）
   - 右键菜单
   - 悬浮窗
   - 设置/个人信息界面
   - 数据可视化展示
2. 键盘监听模块
   - 按键捕获
   - 按键处理
3. 数据处理模块
   - 数据存储
   - 数据分析
4. 配置管理模块
   - 用户配置
   - 多用户管理
5. 热力图生成模块
   - 热力图计算
   - 热力图渲染
6. 系统集成模块
   - 开机自启动
   - 隐私保护

## 3. 功能详细设计

### 3.1 用户界面模块

#### 3.1.1 主窗口

- 包含"显示"、"设置"、"个人"三个主要标签页
- 左侧提供快速导航栏

#### 3.1.2 显示设置

- 控制按键显示的开关
- 调整字体大小、显示时长、淡出时长
- 自定义悬浮窗颜色和字体颜色

#### 3.1.3 系统设置

- 开机自启动选项
- 特殊键位设置
- 悬浮窗样式选择
- 字体样式选择

#### 3.1.4 个人信息

- 用户选择和管理
- 统计信息显示
- 数据导入导出功能

### 3.2 键盘监听模块

- 使用pynput库监听键盘事件
- 实时捕获按键信息
- 区分普通按键和特殊按键(如Ctrl, Shift等)

### 3.3 数据处理模块

- 记录每个按键的使用次数
- 计算按键使用频率
- 生成按键使用统计报告

### 3.4 配置管理模块

- 保存和加载用户配置
- 管理多用户配置文件
- 处理配置文件的导入导出

### 3.5 热力图生成模块

- 使用matplotlib库生成键盘热力图
- 支持自定义热力图颜色方案
- 提供热力图保存和导出功能

## 4. 数据结构设计

### 4.1 按键数据结构

```python
key_data = {
'key': str, # 按键名称
'count': int, # 按键次数
'last_press_time': float # 最后一次按下的时间戳
}
```

### 4.2 用户配置数据结构

```
user_config = {
'username': str,
'display_settings': {
'font_size': int,
'display_duration': float,
'fade_out_duration': float,
'background_color': str,
'font_color': str
},
'system_settings': {
'auto_start': bool,
'special_keys': dict,
'float_window_style': str,
'font_style': str
}
}
```


## 5. 界面设计

![界面设计](https://raw.githubusercontent.com/zjnbwxq/pictureLinks/master/Snipaste_2024-10-19_14-57-21.png)


## 6. 性能考虑

- 使用多线程处理键盘监听和UI更新,避免界面卡顿
- 定期将按键数据写入文件,防止数据丢失
- 优化热力图生成算法,减少CPU占用
- 使用缓存机制减少频繁的文件I/O操作

## 7. 安全性考虑

- 加密存储用户的按键数据
- 提供隐私模式,允许用户暂停键盘监听
- 明确告知用户使用政策
- 数据全本地存储,避免网络传输风险

## 8. 后续优化计划

- 添加更多数据分析功能,如按键使用趋势图
- 支持自定义键盘布局
- 优化UI设计,提供多种主题选择
- 增加插件系统,允许用户扩展功能

## 10. 项目时间线

| 阶段 | 时间 | 主要任务 |
|------|------|----------|
| 第1-2周 | 5月1日 - 5月14日 | 需求分析和设计文档完善 |
| 第3-6周 | 5月15日 - 6月11日 | 核心功能开发(键盘监听、数据处理、基础UI) |
| 第7-8周 | 6月12日 - 6月25日 | 热力图功能实现 |
| 第9-10周 | 6月26日 - 7月9日 | 用户配置和多用户支持 |
| 第11-12周 | 7月10日 - 7月23日 | 测试、调试和性能优化 |
| 第13周 | 7月24日 - 7月30日 | 文档完善和发布准备 |

## 结语

本设计文档概述了键盘监听与分析软件的主要功能、架构设计和实现细节。在实际开发过程中,可能需要根据具体情况对某些部分进行调整或扩展。如有任何疑问或需要进一步讨论,请及时沟通。
